<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CG coefficients</title>

    <script>
    MathJax={tex:{inlineMath:[['$','$']],displayMath:[['\\[','\\]']]},svg:{fontCache:'global'}};
    </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script id="MathJax-script" async src="../src/MathJax/es5/tex-mml-chtml.js"></script>
  <!-- Load Pyodide from a CDN -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.3/full/pyodide.js"></script>
  <script src="script.js"></script>
</head>
<body>
  <h1>SU(N) CG coefficients calculation</h1>

  This is the Python conversion from Arne Alex's C++ code provided
  <a href="https://homepages.physik.uni-muenchen.de/~vondelft/Papers/ClebschGordan/ClebschGordan.cpp">here</a>.
  <br>
  This Python script [<a href="#" id="downloadLink">download</a>] is compiled to WebAssembly using Pyodide by myself.
  <br>
  <br>
  &mdash; Converted by Atis Yosprakob // 3 Mar 2025
  <br>
  <br>
    <script>
        document.getElementById("downloadLink").addEventListener("click", function(event) {
            event.preventDefault();  // Prevent the default link behavior
            
            // Construct the file data
            let fileData = python_src;
            let weight1 = document.getElementById("input1").value;
            let weight2 = document.getElementById("input2").value;
            let nthWeight = document.getElementById("NWeight").checked;
            if(nthWeight)
                nthWeight = "True"
            else
                nthWeight = "False"

            // Python code with placeholders for input values
            fileData = fileData.replace("__weight1__", weight1);
            fileData = fileData.replace("__weight2__", weight2);
            fileData = fileData.replace("__NWeight__", nthWeight);
            
            // Create a Blob with the file content and specify the MIME type
            const blob = new Blob([fileData], { type: "text/plain" });
            
            // Create a URL for the Blob
            const url = URL.createObjectURL(blob);
            
            // Create a temporary link element to trigger the download
            const a = document.createElement("a");
            a.href = url;
            a.download = "clebsch.py";  // Specify the file name
            document.body.appendChild(a);
            a.click();  // Simulate a click to start the download
            document.body.removeChild(a);  // Clean up the link element
            URL.revokeObjectURL(url);  // Revoke the object URL to free up memory
        });
    </script>

  <hr>



  <!-- Add two input fields with default values -->
  <label for="input1">Irrep 1:</label>
  <input type="text" id="input1" value="(2,1)">
  <br><br>
  <label for="input2">Irrep 2:</label>
  <input type="text" id="input2" value="(3,2)">
  <br><br>

  <!-- Checkbox for N component notation -->
  <label for="nthWeight">N-weight notation:</label>
  <input type="checkbox" id="NWeight">
  <br>
  If ticked, the irrep weight will have $N$ components with 0 at the end.
  <br><br>

  <button id="run-code">Compute the CG coefficients</button>
  <pre id="result"></pre>

  <script>
    async function main() {

      let is_initial = true

      // Load Pyodide from the CDN with the appropriate indexURL.
      const pyodide = await loadPyodide({
        indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.3/full/"
      });

      await pyodide.loadPackage("numpy");

      // Redirect Python's stdout to capture print output
      pyodide.globals.set("print", (text) => {
        if(is_initial){
            document.getElementById("result").textContent = "";
            is_initial = false
        }
        document.getElementById("result").textContent += text + "\n";
      });

      // When the button is clicked, run the Python code.
      document.getElementById("run-code").addEventListener("click", async () => {

        document.getElementById("result").textContent = "computing...";
        is_initial = true

        // Get the values from the input forms
        let weight1 = document.getElementById("input1").value;
        let weight2 = document.getElementById("input2").value;
        let nthWeight = document.getElementById("NWeight").checked;
        if(nthWeight)
            nthWeight = "True"
        else
            nthWeight = "False"

        // Python code with placeholders for input values
        let pythonCode = python_src;
        pythonCode = pythonCode.replace("__weight1__", weight1);
        pythonCode = pythonCode.replace("__weight2__", weight2);
        pythonCode = pythonCode.replace("__NWeight__", nthWeight);

        try {
          // Execute the Python code asynchronously
          await pyodide.runPythonAsync(pythonCode);
        } catch (err) {
          document.getElementById("result").textContent = 'Error: ' + err;
        }
      });
    }

    // Start the main function once the page is loaded.
    main();
  </script>
</body>
</html>
